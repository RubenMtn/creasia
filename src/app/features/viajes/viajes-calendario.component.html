<!-- archivo: src/app/features/viajes/viajes-calendario.component.html -->
<section class="cal-root" aria-labelledby="cal-heading">
    <h3 id="cal-heading" class="cal-title">Disponibilidad para viajar en el próximo año y medio:</h3>

    @if (loading()) {
    <p class="cal-state">Cargando disponibilidad…</p>
    } @else if (error()) {
    <p class="cal-error" role="alert">{{ error() }}</p>
    } @else {
    <!-- Leyenda superior -->
    <div class="cal-legend cal-legend--top" aria-hidden="true">
        <strong>Número de viajeros interesados:</strong>
        <span><i class="swatch tone-0"></i> 0</span>
        <span><i class="swatch tone-1"></i> 1</span>
        <span><i class="swatch tone-2"></i> 2–4</span>
        <span><i class="swatch tone-3"></i> 5+</span>
    </div>

    <div class="cal-grid">
        @for (mes of months(); track mes.year + '-' + mes.monthIndex) {
        <article class="cal-month" aria-label="{{ mes.monthName }} de {{ mes.year }}">
            <header class="cal-month__header">
                <h4 class="cal-month__title">{{ mes.monthName }} {{ mes.year }}</h4>
            </header>

            <table class="cal-table" role="grid">
                <caption class="sr-only">Calendario de {{ mes.monthName }} {{ mes.year }}</caption>
                <thead>
                    <tr>
                        <th scope="col" abbr="Lunes">L</th>
                        <th scope="col" abbr="Martes">M</th>
                        <th scope="col" abbr="Miércoles">X</th>
                        <th scope="col" abbr="Jueves">J</th>
                        <th scope="col" abbr="Viernes">V</th>
                        <th scope="col" abbr="Sábado">S</th>
                        <th scope="col" abbr="Domingo">D</th>
                    </tr>
                </thead>
                <tbody>
                    @for (week of mes.weeks; track week[0].iso) {
                    <tr role="row">
                        @for (day of week; track day.iso) {
                        <td [class.is-outside]="!day.inMonth" [attr.aria-label]="
                        (day.inMonth ? '' : 'Fuera de mes, ') +
                        (day.date.getDate()) + ' de ' + mes.monthName + ' de ' + mes.year +
                        '. Interesados: ' + day.count
                      ">
                            <div class="cell" [class.tone-0]="day.count === 0" [class.tone-1]="day.count === 1"
                                [class.tone-2]="day.count >= 2 && day.count <= 4" [class.tone-3]="day.count >= 5">
                                <span class="num">{{ day.date.getDate() }}</span>
                                @if (day.count > 0 && day.inMonth) {
                                <span class="badge" aria-hidden="true">{{ day.count }}</span>
                                }
                            </div>
                        </td>
                        }
                    </tr>
                    }
                </tbody>
            </table>
        </article>
        }
    </div>

    <div class="cal-legend" aria-hidden="true">
        <span><i class="swatch tone-0"></i> 0</span>
        <span><i class="swatch tone-1"></i> 1</span>
        <span><i class="swatch tone-2"></i> 2–4</span>
        <span><i class="swatch tone-3"></i> 5+</span>
    </div>
    }
</section>