/* ============================================================
   Archivo: src/app/features/viajes/viajes-calendario.component.scss
   Calendario Viajes — Alto contraste sobre fondo NEGRO
   ------------------------------------------------------------
   ✅ Celdas cuadradas garantizadas (1:1) en todos los tamaños.
   ✅ Fallback para navegadores sin aspect-ratio.
   ✅ La tabla ocupa un poco más a lo ancho.
   ✅ Espaciado entre filas = columnas.
   ============================================================ */

/* === Variables locales del componente === */
:host {
  /* Proporción ancho/alto de cada día → celdas cuadradas */
  --cell-aspect: 1;

  /* Altura mínima “de seguridad” (no debe superar el ancho de una celda) */
  /* 14cqw ≈ 100/7 del ancho de la tarjeta (7 días), ajustado por gaps */
  --cell-min: clamp(44px, 14cqw, 54px);

  /* Gaps iguales en X e Y */
  --cell-gap-x: 0.45rem;
  --cell-gap-y: 0.45rem;

  /* === Selección por rango (variables) === */
  --sel-bg: rgba(37, 99, 235, 0.16);
  /* azul suave */
  --sel-bg-strong: rgba(37, 99, 235, 0.22);
  --sel-outline: rgba(37, 99, 235, 0.7);
  /* azul accesible */

  /* Días “propios” */
  --mine-outline: #fbbf24;
  /* amber-400 aprox. */

  display: block;
}

/* Contenedor principal */
.cal-root {
  background: #000;
  color: #fff;
  padding: .25rem;
}

/* Título */
.cal-title {
  font-size: 1.3rem;
  margin: 0 0 1rem;
  color: #fff;
}

/* Estados */
.cal-state,
.cal-error {
  padding: .8rem 1rem;
  border-radius: .6rem;
  border: 1px solid #2b2b2b;
  background: #0f0f0f;
  color: #fff;
}

.cal-error {
  border-left: 4px solid #e11d48;
}

/* === Grid de meses === */
.cal-grid {
  display: grid;
  gap: 1.1rem;
  grid-template-columns: 1fr;
}

@media (min-width: 640px) {
  .cal-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (min-width: 1024px) {
  .cal-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

/* Tarjeta de mes (activamos container para cqw) */
.cal-month {
  border: 1px solid #2b2b2b;
  border-radius: 12px;
  background: #000;
  box-shadow: 0 1px 6px rgba(0, 0, 0, .45);

  /* Reducimos padding para que la tabla “respire” más a lo ancho */
  padding: .5rem .55rem;

  /* Para que 1cqw mida el ancho de la tarjeta (útil para --cell-min) */
  container-type: inline-size;
}

.cal-month__header {
  margin-bottom: .55rem;
}

.cal-month__title {
  margin: 0;
  font-size: 1.05rem;
  font-weight: 750;
  color: #fff;
}

/* === Tabla mensual === */
.cal-table {
  width: 100%;
  table-layout: fixed;
  /* columnas iguales */
  border-collapse: separate;
  /* necesario para border-spacing */
  border-spacing: var(--cell-gap-x) var(--cell-gap-y);
}

.cal-table thead th {
  font-weight: 700;
  font-size: .95rem;
  text-align: center;
  color: #e5e7eb;
  /* blanco roto */
  padding: .35rem 0;
  border-bottom: 1px solid #2b2b2b;
}

.cal-table tbody td {
  padding: 0;
  vertical-align: top;
  /* evita estirones por contenido */
}

/* ---------- Estructura de cada día ----------
  <td [class.is-outside]="...">
    <div class="cell [tone-0|tone-1|tone-2|tone-3]">
      <span class="num">…</span>
      <span class="badge">…</span>
    </div>
  </td>
------------------------------------------------ */

/* Wrapper del día (div) — aquí forzamos CUADRADO */
.cal-table .cell {
  position: relative;
  display: grid;
  place-items: center;

  /* ✅ Cuadrado nativo (ancho = alto) */
  aspect-ratio: var(--cell-aspect) / 1;

  /* Altura mínima de seguridad (no pisa la proporción al ser ≤ ancho celda) */
  min-block-size: var(--cell-min);

  border: 1px solid #333;
  border-radius: .7rem;
  overflow: hidden;

  background: #ffffff;
  /* día sin interés → blanco */
  color: #111;
  /* texto oscuro */
}

/* Fallback robusto para navegadores SIN aspect-ratio */
@supports not (aspect-ratio: 1 / 1) {
  .cal-table .cell {
    /* Quitamos la dependencia de min-block-size para no romper el cuadrado */
    min-block-size: 0;
  }

  .cal-table .cell::before {
    content: "";
    display: block;
    width: 100%;
    padding-top: calc(100% / var(--cell-aspect));
    /* alto = ancho */
    grid-area: 1 / 1;
  }

  .cal-table .cell>* {
    grid-area: 1 / 1;
    /* contenido encima del spacer */
  }
}

/* Tonos por nº de interesados */
.cal-table .tone-0 {
  background: #ffffff !important;
  color: #111 !important;
}

.cal-table .tone-1 {
  background: #ffe466 !important;
  color: #111 !important;
}

.cal-table .tone-2 {
  background: #EFCF52 !important;
  color: #111 !important;
}

.cal-table .tone-3 {
  background: #DFBA3E !important;
  color: #111 !important;
}

.cal-table .tone-4 {
  background: goldenrod !important;
  color: #111 !important;
}

.cal-table .tone-5 {
  background: #C89B1F !important;
  color: #111 !important;
}

.cal-table .tone-6 {
  background: #C09015 !important;
  color: #111 !important;
}

.cal-table .tone-7 {
  background: darkgoldenrod !important;
  color: #111 !important;
}

/* Días fuera del mes */
.cal-table td.is-outside .cell {
  background: #171717 !important;
  color: #9ca3af !important;
  border-style: dashed;
  /* blindamos interacción visual */
  outline: none !important;
  box-shadow: none !important;
}

/* ⛔️ Bloquear cualquier marca de selección/borde en fuera de mes */
.cal-table td.is-outside,
.cal-table td.is-outside .cell {
  outline: none !important;
  box-shadow: none !important;
}

.cal-table td.is-outside.is-selected,
.cal-table td.is-outside.is-in-range,
.cal-table td.is-outside.is-selected .cell,
.cal-table td.is-outside.is-in-range .cell {
  background: #171717 !important;
  /* mantener fondo “casi negro” */
  outline: none !important;
  box-shadow: none !important;
}

/* Quitar resaltado “mis días” fuera de mes */
.cal-table td.is-outside.is-mine .cell,
.cal-table td.is-outside .cell.is-mine,
.cal-day.is-outside.is-mine,
td.is-outside.is-mine,
.day.is-outside.is-mine {
  outline: none !important;
  box-shadow: none !important;
}

/* Tipografía interna */
.cal-table .num {
  font-size: 1.15rem;
  /* presencia del número del día */
  line-height: 1;
  font-weight: 800;
  position: relative;
  top: 2px;
  /* ajuste fino */
}

.cal-table .badge {
  position: absolute;
  right: .1rem;
  top: .05rem;
  /* posición vertical del contador */
  min-width: 1.5rem;
  height: 1.5rem;
  padding: 0 .2rem;
  background: transparent !important;
  color: white !important;
  font-size: 1rem;
  font-weight: 900;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 0;
  pointer-events: none;
  /* no bloquea clics */
  text-shadow: 0 0 2px #fff;
  /* mejora lectura sobre amarillos */
}

/* Leyenda */
.cal-legend {
  display: flex;
  gap: .95rem;
  align-items: center;
  margin-top: .9rem;
  color: #e5e7eb;
  font-size: .95rem;
}

.cal-legend .swatch {
  width: 1.15rem;
  height: 1.15rem;
  border-radius: .35rem;
  border: 1px solid #333;
  display: inline-block;
  margin-right: .35rem;
  vertical-align: -2px;
}

.cal-legend .tone-0 {
  background: #ffffff;
}

.cal-legend .tone-1 {
  background: #ffe466;
}

.cal-legend .tone-2 {
  background: #EFCF52;
}

.cal-legend .tone-3 {
  background: #DFBA3E;
}

.cal-legend .tone-4 {
  background: #C89B1F;
}

.cal-legend .tone-5 {
  background: goldenrod;
}

.cal-legend .tone-6 {
  background: #C09015;
}

.cal-legend .tone-7 {
  background: darkgoldenrod;
}

.cal-legend--top {
  color: #fff;
}

.cal-legend--top strong {
  margin-right: .4rem;
}

/* === Selección por rango (fondos azules suaves — SOLO en mes actual) === */
.cal-table td.is-selected:not(.is-outside),
.cal-table td.is-selected:not(.is-outside) .cell {
  background: var(--sel-bg-strong);
  outline: 2px solid var(--sel-outline);
  outline-offset: -2px;
  /* que quede dentro */
}

.cal-table td.is-in-range:not(.is-outside),
.cal-table td.is-in-range:not(.is-outside) .cell {
  background: var(--sel-bg);
}

/* === Selección por rango con contorno (sin cubrir tonos) === */
.cal-table td.is-selected:not(.is-outside) .cell {
  /* extremos del rango o selección única */
  box-shadow: inset 0 0 0 2px var(--sel-outline);
  border-radius: 0.4rem;
}

.cal-table td.is-in-range:not(.is-outside) .cell {
  /* interior del rango (contorno más sutil) */
  box-shadow: inset 0 0 0 1px var(--sel-outline);
  border-radius: 0.35rem;
}

/* === Días del propio usuario (borde amarillo fuerte) === */
.cal-table td.is-mine .cell {
  box-shadow: inset 0 0 0 2px var(--mine-outline);
  border-radius: 0.4rem;
}

/* (Regla amplia heredada en proyecto) — mantenida pero anulada en fuera de mes */
.cal-day.is-mine,
td.is-mine,
.day.is-mine,
.cell.is-mine {
  outline: 3px solid red;
  /* borde rojo “propio” (pedías anularlo fuera de mes: hecho arriba) */
  outline-offset: -2px;
  box-shadow: 0 0 0 2px #ffd000 inset;
}

/* Aviso de login por mes */
.login-hint {
  margin-top: 0.5rem;
  color: #fbbf24;
  /* aviso en amarillo cálido */
  font-size: 0.95rem;
}

/* Acciones globales (guardar) */
.cal-actions {
  display: flex;
  gap: 0.75rem;
  align-items: center;
  margin-top: 0.75rem;
}

.btn-save {
  border: 0;
  border-radius: 0.6rem;
  padding: 0.5rem 0.9rem;
  background: #1d4ed8;
  /* azul */
  color: #fff;
  cursor: pointer;
}

.btn-save:hover {
  filter: brightness(1.06);
}

.range-label {
  /* base móvil; si ya tienes tamaño, respétalo */
  font-size: 0.95rem;
  /* opcional, ajusta a tu escala */
  opacity: 0.9;
}

/* Tablet en adelante */
@media (min-width: 768px) {
  .range-label {
    font-size: 0.85rem;
    /* un paso más pequeña */
    opacity: 0.9;
  }
}

/* Desktop medio+ (opcional) */
@media (min-width: 1024px) {
  .range-label {
    font-size: 0.8rem;
    /* otro paso si quieres compactar más */
    opacity: 0.85;
  }
}

.save-result {
  font-size: .875rem;
  margin-right: .5rem;
}

.save-result.ok {
  color: #16a34a;
}

/* verde */
.save-result.err {
  color: #dc2626;
}

/* rojo */
.save-result.deleted {
  border-color: #d97706;
  color: #d97706;
}

.cal-intro {
  margin: 12px 0 16px;
  line-height: 1.4;
}

.cal-intro p {
  margin: 0;
}

/* Pasado: fondo gris oscuro y sin interacción (mata tonos/selección) */
.cal-table td.is-past .cell {
  background: rgb(53, 53, 53) !important;
  /* fuerza sobre .tone-* */
  color: #111 !important;
  box-shadow: none !important;
  /* mata contornos de selección / "mine" */
  outline: 0 !important;
  opacity: .95;
  pointer-events: none;
  /* sin clic */
}

/* Hoy: más grande y consistente (relativo al .num, no al contenedor) */
td.is-today .num {
  font-size: 1.2em;
  /* 20% sobre el 1.15rem de .num → ~1.38rem */
  font-weight: 900;
  /* valor válido y contundente */
  color: #1d4ed8;
  transform: translateY(-1px);
  /* compensa el top de .num y mejora la lectura */
}

@media (max-width: 480px) {
  td.is-today .num {
    font-size: 1.3em;
  }

  /* ~1.495rem: se nota sin romper la malla */
}

/* Ancho del separador fin de semana (ajustable) */
:host {
  --weekend-gap: 0.05rem;
}

/* Columna del separador (colgroup) */
.cal-table col.sep-col {
  width: var(--weekend-gap);
}

/* Celdas separador en header y body: sin bordes ni interacción */
.cal-table .week-sep,
.cal-table th.week-sep {
  padding: 0;
  border: 0;
  width: var(--weekend-gap);
  background: transparent !important;
  pointer-events: none;
}

/* Ajuste micro del fin de semana (sin columna extra) */
:host {
  --weekend-extra-gap: 0.12rem;
}

/* baja hasta 0.02rem si quieres */

/* Empuja un poco el contenido de Sábado para simular hueco fino */
.cal-table tbody td:nth-child(6) .cell {
  margin-left: var(--weekend-extra-gap);
}

/* Encabezado Sábado con un pelín más de aire a la izquierda */
.cal-table thead th:nth-child(6) {
  padding-left: calc(0.35rem + var(--weekend-extra-gap));
}

/* (Opcional) línea sutil antes de Sábado, sin alterar la rejilla */
.cal-table tbody td:nth-child(6),
.cal-table thead th:nth-child(6) {
  position: relative;
}

.cal-table tbody td:nth-child(6)::before,
.cal-table thead th:nth-child(6)::before {
  content: '';
  position: absolute;
  left: -1px;
  top: 0;
  bottom: 0;
  width: 1px;
  background: #2b2b2b;
  /* ajusta el color si quieres */
  pointer-events: none;
}