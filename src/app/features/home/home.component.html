<section class="hero" [class.skip-to-end]="skipToEnd">
  <div #mediaWrap class="media-wrap" [style.aspect-ratio]="frameAR">

    @if (isBrowser && !animationDone) {
      <video #vid class="layer video" src="assets/video/facev.mp4" autoplay muted playsinline preload="auto"
        (loadedmetadata)="onMeta(vid)" (ended)="startFade(vid)" (transitionend)="onFadeEnd($event)"
        [class.fade-out]="fading">
      </video>
    }

    <img class="layer image" src="assets/images/facedok.png" alt="Ilustracion" [class.visible]="showImage">

    @if (showPoints) {
      <div class="layer points-layer" aria-hidden="true">
        @for (point of scaledPoints; track point.id) {
          <span #facePoint class="point" [attr.data-point]="point.id" [style.left.%]="point.left" [style.top.%]="point.top"></span>
        }
      </div>
    }

    @if (showConnectors && connectors.length) {
      <svg class="layer lines-layer" viewBox="0 0 100 100" preserveAspectRatio="none">
        <!-- Gradientes por conector: más transparente cerca del botón (x1,y1) -->
        <defs>
          @for (c of connectors; track c.id) {
            <linearGradient
              [attr.id]="'grad-'+c.id"
              gradientUnits="userSpaceOnUse"
              [attr.x1]="c.x1" [attr.y1]="c.y1"
              [attr.x2]="c.x2" [attr.y2]="c.y2">
              <stop offset="0%"   stop-color="#fff" stop-opacity="0"/>
              <stop offset="65%"  stop-color="#fff" stop-opacity="0.5"/>
              <stop offset="100%" stop-color="#fff" stop-opacity="1"/>
            </linearGradient>
          }
        </defs>

        <!-- Líneas creciendo sin dash (adiós “raya-espacio”) -->
        @for (c of connectors; track c.id) {
          <line
            [attr.x1]="c.x1" [attr.y1]="c.y1"
            [attr.x2]="c.x1 + (c.x2 - c.x1) * c.progress"
            [attr.y2]="c.y1 + (c.y2 - c.y1) * c.progress"
            [attr.stroke]="'url(#grad-'+c.id+')'"
            stroke-linecap="round" />
        }
      </svg>
    }
  </div>

  <!-- Enlaces superpuestos que aparecen al terminar el fade del video -->
  @if (showLinks) {
    <nav class="link-layer">
      @for (item of displayLinks; track item.route; let i = $index) {
        <a class="link typography-button-text {{ item.cls }}" #linkEl
          [attr.data-point]="item.pointId"
          [attr.data-anchor]="item.anchor"
          [routerLink]="item.route"
          [style.animationDelay.ms]="linksPhaseOffset + baseDelay + stagger * i">
          {{ item.key | t }}
        </a>
      }
    </nav>
  }
</section>

@if (showLinks) {
  <p class="title-below typography-section-title">
    {{ 'home.title' | t }}
  </p>
  <br />

  <app-carousel style="width:50vw;display:block;margin:0 auto"
    [images]="homeSlides"
    [autoplayMs]="7000"
    [transitionMs]="800"
    [separatorRatio]="0.3"
    [separatorColor]="'#000'"
    [pauseOnHover]="true"
    [fadeEdges]="true"
    [fadeEdgeWidth]="0.03"
    [fadeColor]="'rgba(0,0,0,0.95)'"
    [height]="'calc(80vw * 7/16)'">
  </app-carousel>

  <br />

  <p class="caption-below typography-body-text">
    {{ 'home.caption' | t }}
  </p>
}
