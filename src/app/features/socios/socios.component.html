<section class="content container">

  @if (!showLoginForm) {
  <div class="register-block">
    @if (!showRegisterForm) {

    <div class="intro">
      <h2 class="title typography-section-title">{{ 'socios.title' | t }}</h2>
    </div>

    <p class="register-caption typography-body-text">{{ 'socios.caption' | t }}</p>

    <button class="cta typography-button-text" type="button" (click)="openRegister()">
      {{ 'socios.actions.register' | t }}
    </button>
    } @else {
    <!-- <p class="register-caption typography-body-text">{{ 'socios.caption' | t }}</p> -->

    @if (!okMsg) {
    <form class="form" (submit)="onRegisterSubmit($event)" novalidate>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.name' | t }}</span>
        <input class="field__control" type="name" name="registerName" required autocomplete="name" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.surname' | t }}</span>
        <input class="field__control" type="surname" name="registerSurname" autocomplete="surname" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.email' | t }}</span>
        <input class="field__control" type="email" name="registerEmail" required autocomplete="email" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.password' | t }}</span>
        <input class="field__control" type="password" name="registerPassword" required minlength="8"
          autocomplete="new-password" />
      </label>

      <label class="opt-in">
        <input type="checkbox" name="registerOptIn" />
        <span class="opt-in__label typography-body-text">{{ 'socios.registerForm.optIn' | t }}</span>
      </label>

      <button class="submit typography-button-text" type="submit" [disabled]="loading"
        [attr.aria-busy]="loading ? 'true' : null" [attr.aria-disabled]="loading ? 'true' : null">
        {{ loading ? ('general.loading' | t) : ('socios.registerForm.submit' | t) }}
      </button>

      <!-- ERROR traducido -->
      <p *ngIf="error" class="intro title typography-section-title" role="alert" aria-live="assertive">
        {{ error | t }}
      </p>
    </form>

    <button class="text-link typography-body-text" type="button" (click)="openLogin()">
      {{ 'socios.registerForm.alreadyRegistered' | t }}
    </button>
    } @else {
    <!-- Mensaje OK tras registro correcto (SIN enlace a login hasta activar) -->
    <p class="intro title typography-section-title" role="status" aria-live="polite" style="white-space: pre-line">
      {{ okMsg | t }}
    </p>
    <!-- (No mostramos el enlace "Ya estoy registrado" aquí) -->
    }
    }
  </div>

  @if (!showRegisterForm) {
  <div class="login-block">
    <p class="login-caption typography-body-text">{{ 'socios.loginCaption' | t }}</p>

    <button class="cta secondary typography-button-text" type="button" (click)="openLogin()">
      {{ 'socios.actions.login' | t }}
    </button>
  </div>
  }
  }

  @if (showLoginForm) {
  <div class="login-block login-block--active">
    <!-- <p class="login-caption typography-body-text">{{ 'socios.loginCaption' | t }}</p> -->

    <!-- Si el OK es de activación, mostramos el mensaje y mantenemos el formulario -->
    <p *ngIf="okMsg === 'socios.activation.ok'" class="intro title typography-section-title" role="status"
      aria-live="polite" style="white-space: pre-line">
      {{ okMsg | t }}
    </p>

    <!-- Formulario visible si no hay okMsg o si el okMsg es de activación -->
    <form class="form form--login" (submit)="onLoginSubmit($event)" novalidate
      *ngIf="!okMsg || okMsg === 'socios.activation.ok'">
      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.loginForm.email' | t }}</span>
        <input class="field__control" type="email" name="loginEmail" required autocomplete="email" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.loginForm.password' | t }}</span>
        <input class="field__control" type="password" name="loginPassword" required minlength="8"
          autocomplete="current-password" />
      </label>

      <button class="submit typography-button-text" type="submit" [disabled]="loading"
        [attr.aria-busy]="loading ? 'true' : null" [attr.aria-disabled]="loading ? 'true' : null">
        {{ loading ? ('general.loading' | t) : ('socios.loginForm.submit' | t) }}
      </button>
    </form>

    <!-- Error debajo del form -->
    <p *ngIf="error" class="intro title typography-section-title" role="alert" aria-live="assertive">
      {{ error | t }}
    </p>

    <button class="text-link typography-body-text" type="button" (click)="openRegister()" *ngIf="!okMsg && !loading">
      {{ 'socios.loginForm.notRegistered' | t }}
    </button>


    <!-- Si el OK NO es de activación (p. ej., saludo tras login), mostramos solo el mensaje -->
    <p *ngIf="okMsg && okMsg !== 'socios.activation.ok'" class="intro title typography-section-title" role="status"
      aria-live="polite" style="white-space: pre-line">
      {{ okMsg | t }}<ng-container *ngIf="greetName"> {{ greetName }}</ng-container>
    </p>
  </div>
  }

</section>