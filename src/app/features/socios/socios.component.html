<section class="content container">

  <div class="intro">
    <h2 class="title typography-section-title">{{ 'socios.title' | t }}</h2>
  </div>

  @if (showLoginForm) {
  <!-- ===== LOGIN ===== -->
  <div class="login-block login-block--active">

    <!-- Cabecera de login: solo cuando NO hay okMsg -->
    <p class="login-caption typography-body-text" *ngIf="!okMsg">
      {{ 'socios.loginCaption' | t }}
    </p>

    <!-- Mensaje OK de activación (mantiene el formulario visible) -->
    <p *ngIf="okMsg === 'socios.activation.ok'" class="intro title typography-section-title" role="status"
      aria-live="polite" style="white-space: pre-line">
      {{ okMsg | t }}
    </p>

    <!-- Formulario de login (visible salvo que haya un okMsg distinto al de activación) -->
    <form class="form form--login" (submit)="onLoginSubmit($event)" novalidate
      *ngIf="!okMsg || okMsg === 'socios.activation.ok'">
      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.loginForm.email' | t }}</span>
        <input class="field__control" type="email" name="loginEmail" required autocomplete="email" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.loginForm.password' | t }}</span>
        <input class="field__control" type="password" name="loginPassword" required minlength="8"
          autocomplete="current-password" />
      </label>

      <button class="submit typography-button-text" type="submit" [disabled]="loading"
        [attr.aria-busy]="loading ? 'true' : null" [attr.aria-disabled]="loading ? 'true' : null">
        {{ loading ? ('general.loading' | t) : ('socios.loginForm.submit' | t) }}
      </button>
    </form>

    <!-- Error debajo del form -->
    <p *ngIf="error" class="intro title typography-section-title" role="alert" aria-live="assertive">
      {{ error | t }}
    </p>

    <!-- Enlace a registro (solo si no hay saludo ni loading) -->
    <button class="text-link typography-body-text" type="button" (click)="openRegister()" *ngIf="!okMsg && !loading">
      {{ 'socios.loginForm.notRegistered' | t }}
    </button>

    <!-- Saludo tras login correcto (oculta cabecera y formulario) -->
    <ng-container *ngIf="okMsg && okMsg !== 'socios.activation.ok'">
      <p class="intro title typography-section-title" role="status" aria-live="polite" style="white-space: pre-line">
        {{ okMsg | t }}<ng-container *ngIf="greetName"> {{ greetName }}</ng-container>
      </p>
      <p class="typography-body-text" aria-live="polite">
        {{ 'socios.loginRedirect' | t }}
      </p>
    </ng-container>
  </div>

  } @else {
  <!-- ===== REGISTRO ===== -->
  <div class="register-block">

    <!-- (Cabecera de registro eliminada para que no aparezca al abrir registro) -->

    @if (!okMsg) {
    <form class="form" (submit)="onRegisterSubmit($event)" novalidate>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.name' | t }}</span>
        <input class="field__control" type="name" name="registerName" required autocomplete="name" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.surname' | t }}</span>
        <input class="field__control" type="surname" name="registerSurname" autocomplete="surname" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.email' | t }}</span>
        <input class="field__control" type="email" name="registerEmail" required autocomplete="email" />
      </label>

      <label class="field">
        <span class="field__label typography-body-text">{{ 'socios.registerForm.password' | t }}</span>
        <input class="field__control" type="password" name="registerPassword" required minlength="8"
          autocomplete="new-password" />
      </label>

      <label class="opt-in">
        <input type="checkbox" name="registerOptIn" />
        <span class="opt-in__label typography-body-text">{{ 'socios.registerForm.optIn' | t }}</span>
      </label>

      <button class="submit typography-button-text" type="submit" [disabled]="loading"
        [attr.aria-busy]="loading ? 'true' : null" [attr.aria-disabled]="loading ? 'true' : null">
        {{ loading ? ('general.loading' | t) : ('socios.registerForm.submit' | t) }}
      </button>

      <!-- ERROR traducido -->
      <p *ngIf="error" class="intro title typography-section-title" role="alert" aria-live="assertive">
        {{ error | t }}
      </p>
    </form>

    <!-- Ya tengo cuenta -->
    <button class="text-link typography-body-text" type="button" (click)="openLogin()">
      {{ 'socios.registerForm.alreadyRegistered' | t }}
    </button>

    } @else {
    <!-- Mensaje OK tras registro correcto (sin enlace a login hasta activar) -->
    <p class="intro title typography-section-title" role="status" aria-live="polite" style="white-space: pre-line">
      {{ okMsg | t }}
    </p>
    }
  </div>
  }
  &#8203;<br>
  &#8203;<br>
  &#8203;<br>
  &#8203;<br>
  &#8203;<br>
</section>