<!--
  Carrusel accesible con continuidad (clones).
  - tabindex="0" para navegación con teclado.
  - (transitionend) en el track para detectar fin y “saltar” sin transición.
-->
<section
  class="carousel"
  [style.height]="height"
  role="region"
  aria-roledescription="carousel"
  [attr.aria-label]="'Carrusel de imágenes (' + images.length + ' ítems)'"
  tabindex="0"
  (touchstart)="onTouchStart($event)"
  (touchmove)="onTouchMove($event)"
  (touchend)="onTouchEnd()"
>
  <!-- Pista -->
  <div
    #trackEl
    class="track"
    [class.notransition]="!enableTransition"
    [style.transform]="trackTranslate"
    [style.height]="height"
    (transitionend)="onTrackTransitionEnd($event)"
  >
    <!-- Render extendido: [última] + imágenes + [primera] -->
    <ng-container *ngFor="let it of extendedImages; let i = index">
      <div class="slide" [style.height]="height">
        <a *ngIf="it.link; else noLink" [href]="it.link" class="slide-link" tabindex="-1" aria-hidden="true">
          <img class="slide-img" [src]="it.src" [alt]="it.alt || ''" loading="lazy" />
          <div *ngIf="it.caption" class="caption">{{ it.caption }}</div>
        </a>
        <ng-template #noLink>
          <img class="slide-img" [src]="it.src" [alt]="it.alt || ''" loading="lazy" />
          <div *ngIf="it.caption" class="caption">{{ it.caption }}</div>
        </ng-template>
      </div>
    </ng-container>
  </div>

  <!-- Flechas -->
  <button
    *ngIf="showArrows && images.length > 1"
    class="nav nav-prev"
    type="button"
    aria-label="Anterior"
    (click)="prev()"
  >
    &#10094;
  </button>
  <button
    *ngIf="showArrows && images.length > 1"
    class="nav nav-next"
    type="button"
    aria-label="Siguiente"
    (click)="next()"
  >
    &#10095;
  </button>

  <!-- Indicadores -->
  <div *ngIf="showIndicators && images.length > 1" class="indicators" role="tablist" aria-label="Indicadores">
    <button
      *ngFor="let _ of images; let i = index"
      type="button"
      class="dot"
      [class.active]="i === current"
      (click)="goTo(i)"
      [attr.aria-label]="'Ir a la diapositiva ' + (i + 1)"
      [attr.aria-selected]="i === current"
      role="tab"
    ></button>
  </div>
</section>
